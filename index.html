<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø®Ø±ÙŠØ·Ø© ØªÙˆÙ†Ø³ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© â€” TuniBless</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    :root{ --accent:#00796b; --muted:#55606a; --hover-color: #ffc107; } /* Ø£Ø¶ÙÙ†Ø§ Ù„ÙˆÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ… Ù‡Ù†Ø§ */
    body{ font-family: "Noto Kufi Arabic", "Segoe UI", Tahoma, Arial; margin:0; background:#f5fbf9; color:#073642 }
    .wrap{ max-width:1200px; margin:20px auto; padding:18px; display:grid; grid-template-columns: 1fr 360px; gap:18px }
    header{ grid-column:1/-1; display:flex; justify-content:space-between; align-items:center; gap:8px }
    header h1{ margin:0; font-size:20px }
    header p{ margin:0; color:var(--muted) }
    .map-card{ background:#fff; border-radius:12px; padding:10px; box-shadow:0 10px 30px rgba(3,56,48,0.06); height:720px; overflow:hidden }
    #map{ width:100%; height:100%; border-radius:8px; background-color: #eef6f2; }
    .side{ background:linear-gradient(180deg,#ffffff,#fbfffe); border-radius:12px; padding:14px; box-shadow:0 10px 26px rgba(3,56,48,0.04); height:720px; overflow:auto }
    .side h2{ margin:0 0 6px 0 }
    .meta{ color:var(--muted); font-size:14px }
    .info-row{ display:flex; justify-content:space-between; align-items:center; padding:10px; background:#f7faf8; border-radius:8px; margin-top:12px }
    .btn{ display:inline-block; padding:10px 12px; border-radius:10px; font-weight:700; border:0; cursor:pointer }
    .btn-primary{ background:var(--accent); color:#fff }
    .btn-ghost{ background:transparent; color:var(--accent); border:1px solid #e6f3ef }
    .small{ font-size:13px; color:var(--muted) }
    .legend{ margin-top:14px; font-size:13px; color:var(--muted) }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø© */
    .governorate-label {
      background: transparent;
      border: none;
      box-shadow: none;
      color: #073642;
      font-size: 10px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #fff, -1px -1px 2px #fff, 1px -1px 2px #fff, -1px 1px 2px #fff;
      pointer-events: none; /* Ù„Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„Ù‡Ø§ Ù…Ø¹ Ø§Ù„ÙØ£Ø±Ø© */
    }

    @media (max-width:980px){ .wrap{ grid-template-columns:1fr } .side{ height:auto } .map-card{ height:520px } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ğŸ“ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù„ØªÙˆÙ†Ø³ â€” Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</h1>
        <p class="meta">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø­Ø§ÙØ¸Ø© Ù„ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø§.</p>
      </div>
    </header>

    <div class="map-card" role="region" aria-label="Ø®Ø±ÙŠØ·Ø© ØªÙˆÙ†Ø³ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©">
      <div id="map"></div>
    </div>

    <aside class="side" aria-live="polite">
      <h2 id="side-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</h2>
      <div class="meta" id="side-sub">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.</div>
      <div class="info-row" style="margin-top:12px">
        <div>
          <div style="font-weight:800" id="g-name">Ø§Ø®ØªØ± Ù…Ø­Ø§ÙØ¸Ø©</div>
          <div class="small">Ø§Ù„Ù…Ù†Ø³Ù‚: <span id="g-coord">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></div>
        </div>
        <div style="text-align:left">
          <div class="small">Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†</div>
          <div style="font-weight:800; color:#073642" id="g-count">0</div>
        </div>
      </div>
      <div style="display:flex; gap:8px; margin-top:12px">
        <button class="btn btn-primary" id="openFormBtn">ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      </div>
      <div class="legend">
        <strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©:</strong>
        <div class="small" style="margin-top:6px">ğŸ”’ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ† ØªÙØ®Ø²Ù† ÙÙ‚Ø· Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„.</div>
      </div>
    </aside>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
  /***** Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª *****/
  const GEOJSON_URL = 'TN-gouvernorats.geojson';
  const FORM_LINKS = { /* Ø§Ù„ØµÙ‚ Ø±ÙˆØ§Ø¨Ø·Ùƒ Ù‡Ù†Ø§ */ };
  
  /***** Ø§Ù„ÙƒÙˆØ¯ *****/
  // ØªØ¹Ø¯ÙŠÙ„ 1: ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªÙˆÙ†Ø³ ÙÙ‚Ø·
  const corner1 = L.latLng(37.4, 11.7); // North-East corner
  const corner2 = L.latLng(30.2, 7.5);  // South-West corner
  const bounds = L.latLngBounds(corner1, corner2);

  const map = L.map('map', { 
    zoomControl:true, 
    minZoom:7, 
    maxZoom:12,
    maxBounds: bounds, // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¯ÙˆØ¯
    maxBoundsViscosity: 0.9 // ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ ØµØ¹Ø¨Ø§Ù‹
  }).setView([34.0, 9.0], 7);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap'
  }).addTo(map);

  function styleFeature(feature){
    return {
      color: '#0b6b5e',
      weight: 1.2,
      fillColor: '#e6f9f4',
      fillOpacity: 0.8
    };
  }

  const gNameEl = document.getElementById('g-name');
  const gCoordEl = document.getElementById('g-coord');
  const gCountEl = document.getElementById('g-count');
  const openFormBtn = document.getElementById('openFormBtn');
  
  function highlightFeature(e){
    const layer = e.target;
    // ØªØ¹Ø¯ÙŠÙ„ 2: ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ… Ø¥Ù„Ù‰ Ù„ÙˆÙ† Ù…Ø®Ø§Ù„Ù
    layer.setStyle({ weight: 2.5, color: '#014d43', fillColor: 'var(--hover-color)', fillOpacity: 0.9 });
    if(!L.Browser.ie && !L.Browser.opera && !L.Browser.edge){ layer.bringToFront(); }
  }

  function resetHighlight(e){
    geojson.resetStyle(e.target);
  }

  function selectGovernorate(e) {
      const layer = e.target;
      const props = layer.feature.properties;
      const name = props.NAME_1 || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
      
      gNameEl.textContent = name;
      gCoordEl.textContent = 'Ù„Ù… ÙŠÙØ­Ø¯Ø¯ Ø¨Ø¹Ø¯';
      gCountEl.textContent = 'N/A'; // ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡ Ø¨Ù€ Google Sheet Ù„Ø§Ø­Ù‚Ø§Ù‹
      
      openFormBtn.onclick = () => { 
          const link = FORM_LINKS[name] || '#';
          if (link !== '#') {
              window.open(link, '_blank');
          } else {
              alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· ØªØ³Ø¬ÙŠÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¨Ø¹Ø¯.');
          }
      };
  }

  function onEachFeature(feature, layer){
    const name = feature.properties.NAME_1 || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    
    // ØªØ¹Ø¯ÙŠÙ„ 3: Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…
    layer.bindTooltip(name, {
        permanent: true, 
        direction: 'center', 
        className: 'governorate-label'
    });

    layer.on({ 
        mouseover: highlightFeature, 
        mouseout: resetHighlight, 
        click: selectGovernorate 
    });
  }

  let geojson = null;
  async function loadGeoJSON(){
    try{
      const resp = await fetch(GEOJSON_URL);
      if(!resp.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ GeoJSON');
      const data = await resp.json();
      geojson = L.geoJSON(data, { style: styleFeature, onEachFeature: onEachFeature }).addTo(map);
      map.fitBounds(geojson.getBounds(), { padding:[20,20] });
    }catch(e){ 
      console.error('Error loading GeoJSON:', e); 
      alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª.'); 
    }
  }

  loadGeoJSON();
  </script>
</body>
</html>
